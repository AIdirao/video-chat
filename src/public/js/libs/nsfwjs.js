/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/nsfwjs@4.2.1/dist/cjs/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},__spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.NSFWJS=void 0,exports.load=load;var tf=__importStar(require("@tensorflow/tfjs")),buffer_1=require("buffer/"),nsfw_classes_1=require("./nsfw_classes"),availableModels={MobileNetV2:{numOfWeightBundles:1},MobileNetV2Mid:{numOfWeightBundles:2,options:{type:"graph"}},InceptionV3:{numOfWeightBundles:6,options:{size:299}}},DEFAULT_MODEL_NAME="MobileNetV2",IMAGE_SIZE=224,getGlobal=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof global)return global;if("undefined"!=typeof window)return window;if("undefined"!=typeof self)return self;throw new Error("Unable to locate global object")};function isModelName(e){return!!e&&e in availableModels}var getModelJson=function(e){return __awaiter(void 0,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:return(t=getGlobal().model)?[2,t]:"MobileNetV2"!==e?[3,2]:[4,Promise.resolve().then((function(){return __importStar(require("./model_imports/mobilenet_v2"))}))];case 1:return r=n.sent().modelJson,[3,6];case 2:return"MobileNetV2Mid"!==e?[3,4]:[4,Promise.resolve().then((function(){return __importStar(require("./model_imports/mobilenet_v2_mid"))}))];case 3:return r=n.sent().modelJson,[3,6];case 4:return"InceptionV3"!==e?[3,6]:[4,Promise.resolve().then((function(){return __importStar(require("./model_imports/inception_v3"))}))];case 5:r=n.sent().modelJson,n.label=6;case 6:return[4,r()];case 7:return[2,n.sent().default]}}))}))},getWeightData=function(e){return __awaiter(void 0,void 0,void 0,(function(){var t,r,n,o,i,s,a,l,u,c;return __generator(this,(function(d){switch(d.label){case 0:t=availableModels[e].numOfWeightBundles,r=[],n=0,d.label=1;case 1:return n<t?(o="group1-shard".concat(n+1,"of").concat(t),i=o.replace(/-/g,"_"),(s=getGlobal()[i])?(r.push(((u={})[o]=s,u)),[3,10]):[3,2]):[3,11];case 2:return a=void 0,"MobileNetV2"!==e?[3,4]:[4,Promise.resolve().then((function(){return __importStar(require("./model_imports/mobilenet_v2"))}))];case 3:return a=d.sent().weightBundles,[3,8];case 4:return"MobileNetV2Mid"!==e?[3,6]:[4,Promise.resolve().then((function(){return __importStar(require("./model_imports/mobilenet_v2_mid"))}))];case 5:return a=d.sent().weightBundles,[3,8];case 6:return"InceptionV3"!==e?[3,8]:[4,Promise.resolve().then((function(){return __importStar(require("./model_imports/inception_v3"))}))];case 7:a=d.sent().weightBundles,d.label=8;case 8:return[4,a[n]()];case 9:l=d.sent().default,r.push(((c={})[o]=l,c)),d.label=10;case 10:return n++,[3,1];case 11:return[2,Object.assign.apply(Object,__spreadArray([{}],r,!1))]}}))}))};function loadWeights(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,getWeightData(e)];case 1:return[2,t.sent()];case 2:throw t.sent(),new Error("Could not load the weight data. Make sure you are importing the correct shard files from the models directory. Ref: https://github.com/infinitered/nsfwjs?tab=readme-ov-file#browserify");case 3:return[2]}}))}))}function loadModel(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:if(!isModelName(e))return[2,e];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,getModelJson(e)];case 2:return t=n.sent(),[4,loadWeights(e)];case 3:return r=n.sent(),[2,new JSONHandler(t,r)];case 4:throw n.sent(),new Error("Could not load the model. Make sure you are importing the model.min.js bundle. Ref: https://github.com/infinitered/nsfwjs?tab=readme-ov-file#browserify");case 5:return[2]}}))}))}function load(e){return __awaiter(this,arguments,void 0,(function(e,t){var r,n,o;return void 0===t&&(t={size:IMAGE_SIZE}),__generator(this,(function(i){switch(i.label){case 0:if(null==tf)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return void 0===e?(e=DEFAULT_MODEL_NAME,console.info("%cBy not specifying 'modelOrUrl' parameter, you're using the default model: '".concat(e,"'. See NSFWJS docs for instructions on hosting your own model (https://github.com/infinitered/nsfwjs?tab=readme-ov-file#host-your-own-model)."),"color: lightblue")):isModelName(e)&&(console.info("%cYou're using the model: '".concat(e,"'. See NSFWJS docs for instructions on hosting your own model (https://github.com/infinitered/nsfwjs?tab=readme-ov-file#host-your-own-model)."),"color: lightblue"),t=null!==(o=availableModels[e].options)&&void 0!==o?o:t),t.size=(null==t?void 0:t.size)||IMAGE_SIZE,[4,loadModel(e)];case 1:return r=i.sent(),[4,(n=new NSFWJS(r,t)).load()];case 2:return i.sent(),[2,n]}}))}))}var JSONHandler=function(){function e(e,t){this.modelJson=e,this.weightDataBase64=t}return e.prototype.arrayBufferFromBase64=function(e){for(var t=buffer_1.Buffer.from(e,"base64").toString("binary"),r=t.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=t.charCodeAt(o);return n.buffer},e.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,r,n,o,i,s,a,l,u,c,d,f,h;return __generator(this,(function(p){if(e={modelTopology:this.modelJson.modelTopology,format:this.modelJson.format,generatedBy:this.modelJson.generatedBy,convertedBy:this.modelJson.convertedBy},null!=this.modelJson.weightsManifest){for(t=[],r=[],n=0,o=this.modelJson.weightsManifest;n<o.length;n++){for(i=o[n],s=0,a=i.paths;s<a.length;s++){if(l=a[s],!(u=this.weightDataBase64[l]))throw new Error("Could not find the weight data. Make sure you are importing the correct weight bundle for the model: ".concat(l,".min.js."));c=this.arrayBufferFromBase64(u),r.push(new Uint8Array(c))}t.push.apply(t,i.weights)}for(e.weightSpecs=t,d=new Uint8Array(r.reduce((function(e,t){return e+t.length}),0)),f=0,h=0;h<r.length;h++)d.set(r[h],f),f+=r[h].byteLength;e.weightData=d.buffer}return null!=this.modelJson.trainingConfig&&(e.trainingConfig=this.modelJson.trainingConfig),null!=this.modelJson.userDefinedMetadata&&(e.userDefinedMetadata=this.modelJson.userDefinedMetadata),[2,e]}))}))},e}(),NSFWJS=function(){function e(e,t){this.intermediateModels={},this.options=t,this.normalizationOffset=tf.scalar(255),this.urlOrIOHandler=e,"string"!=typeof e||e.startsWith("indexeddb://")||e.startsWith("localstorage://")||e.endsWith("model.json")?this.urlOrIOHandler=e:this.urlOrIOHandler="".concat(e,"model.json")}return e.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,r,n,o,i=this;return __generator(this,(function(s){switch(s.label){case 0:return e=this.options,t=e.size,"graph"!==e.type?[3,2]:(r=this,[4,tf.loadGraphModel(this.urlOrIOHandler)]);case 1:return r.model=s.sent(),[3,4];case 2:return n=this,[4,tf.loadLayersModel(this.urlOrIOHandler)];case 3:n.model=s.sent(),this.endpoints=this.model.layers.map((function(e){return e.name})),s.label=4;case 4:return[4,(o=tf.tidy((function(){return i.model.predict(tf.zeros([1,t,t,3]))}))).data()];case 5:return s.sent(),o.dispose(),[2]}}))}))},e.prototype.infer=function(e,t){var r=this;if(null!=t&&-1===this.endpoints.indexOf(t))throw new Error("Unknown endpoint ".concat(t,". Available endpoints: ").concat(this.endpoints,"."));return tf.tidy((function(){e instanceof tf.Tensor||(e=tf.browser.fromPixels(e));var n=e.toFloat().div(r.normalizationOffset),o=n,i=r.options.size;if(e.shape[0]!==i||e.shape[1]!==i){o=tf.image.resizeBilinear(n,[i,i],!0)}var s,a=o.reshape([1,i,i,3]);if(null==t)s=r.model;else{if(r.model.hasOwnProperty("layers")&&null==r.intermediateModels[t]){var l=r.model.layers.find((function(e){return e.name===t}));r.intermediateModels[t]=tf.model({inputs:r.model.inputs,outputs:l.output})}s=r.intermediateModels[t]}return s.predict(a)}))},e.prototype.classify=function(e){return __awaiter(this,arguments,void 0,(function(e,t){var r,n;return void 0===t&&(t=5),__generator(this,(function(o){switch(o.label){case 0:return[4,getTopKClasses(r=this.infer(e),t)];case 1:return n=o.sent(),r.dispose(),[2,n]}}))}))},e}();function getTopKClasses(e,t){return __awaiter(this,void 0,void 0,(function(){var r,n,o,i,s,a;return __generator(this,(function(l){switch(l.label){case 0:return[4,e.data()];case 1:for(r=l.sent(),n=[],a=0;a<r.length;a++)n.push({value:r[a],index:a});for(n.sort((function(e,t){return t.value-e.value})),o=new Float32Array(t),i=new Int32Array(t),a=0;a<t;a++)o[a]=n[a].value,i[a]=n[a].index;for(s=[],a=0;a<i.length;a++)s.push({className:nsfw_classes_1.NSFW_CLASSES[i[a]],probability:o[a]});return[2,s]}}))}))}exports.NSFWJS=NSFWJS;
//# sourceMappingURL=/sm/28a88e8c6b7e7028252b6e5004187f8bba334262e7096c78a261dfe219ce9f2f.map